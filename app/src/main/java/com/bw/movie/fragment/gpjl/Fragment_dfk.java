package com.bw.movie.fragment.gpjl;/* *@auther:李泽楷 *@Date: 2019/12/1 *@Time:21:17 *@Description:${DESCRIPTION} **/import android.content.Intent;import android.graphics.drawable.ColorDrawable;import android.view.MotionEvent;import android.view.View;import android.view.ViewGroup;import android.widget.Button;import android.widget.PopupWindow;import android.widget.RadioButton;import android.widget.RadioGroup;import android.widget.TextView;import android.widget.Toast;import androidx.recyclerview.widget.LinearLayoutManager;import androidx.recyclerview.widget.RecyclerView;import com.bawei.lizekai.mylibrary.base.BaseFragment;import com.bawei.lizekai.mylibrary.utils.Logger;import com.bw.movie.GpxqActivity;import com.bw.movie.R;import com.bw.movie.adapter.MyRecyAdapterD;import com.bw.movie.app.App;import com.bw.movie.app.Login;import com.bw.movie.bean.DdxqBean;import com.bw.movie.bean.GpjlBean;import com.bw.movie.bean.ZfBean;import com.bw.movie.contract.IGpjlContract;import com.bw.movie.presenter.IGpjlPresenter;import com.tencent.mm.opensdk.modelpay.PayReq;import java.util.List;import butterknife.BindView;public class Fragment_dfk extends BaseFragment<IGpjlPresenter> implements IGpjlContract.IGpjlView {    public static final String TAG = "Fragment_dfk";    @BindView(R.id.recy_dai)    RecyclerView recyDai;    @BindView(R.id.text)    TextView text;    @BindView(R.id.butt_dfk_price)    Button buttDfkPrice;    Login login = new Login();    String orderId;    double price;    @Override    protected IGpjlPresenter providePresenter() {        return new IGpjlPresenter();    }    @Override    protected int provideLayoutId() {        return R.layout.fragment_dai;    }    @Override    protected void initData() {        super.initData();        mPresenter.getGpjlPresenter(login.userId, login.sessionId, "1", "8", "1");    }    @Override    public void onGpjlSuccess(GpjlBean bean) {        if (bean.getStatus().equals("0000")) {            if (bean.getMessage().contains("无购票记录")) {                text.setVisibility(View.VISIBLE);            } else {                List<GpjlBean.ResultBean> list = bean.getResult();                LinearLayoutManager linearLayoutManager = new LinearLayoutManager(getActivity());                linearLayoutManager.setOrientation(RecyclerView.VERTICAL);                recyDai.setLayoutManager(linearLayoutManager);                MyRecyAdapterD myRecyAdapterD = new MyRecyAdapterD(list, getActivity());                recyDai.setAdapter(myRecyAdapterD);                myRecyAdapterD.setOnClickListener(new MyRecyAdapterD.OnClickListener() {                    @Override                    public void onclick(String orderId1, double price1, int id, int amount) {                        if (id == 2) {                            orderId = orderId1;                            price = price1*amount;                            buttDfkPrice.setVisibility(View.VISIBLE);                            buttDfkPrice.setText("￥" + price);                            buttDfkPrice.setOnClickListener(new View.OnClickListener() {                                @Override                                public void onClick(View view) {                                    initPopWindow(view);                                }                            });                        } else {                            Intent intent = new Intent(getActivity(), GpxqActivity.class);                            intent.putExtra("orderId", orderId1);                            startActivity(intent);                        }                    }                });            }        }else {            Toast.makeText(getActivity(), bean.getMessage(), Toast.LENGTH_SHORT).show();        }    }    @Override    public void onDdxqSuccess(DdxqBean bean) {    }    @Override    public void onZfSuccess(ZfBean bean) {        if (bean.getStatus().equals("0000")){            PayReq payReq = new PayReq();            payReq.appId = bean.getAppId();            payReq.nonceStr = bean.getNonceStr();            payReq.partnerId = bean.getPartnerId();            payReq.prepayId = bean.getPrepayId();            payReq.sign = bean.getSign();            payReq.timeStamp = bean.getTimeStamp();            payReq.packageValue = bean.getPackageValue();            payReq.extData = "app data";            App.api.sendReq(payReq);            buttDfkPrice.setVisibility(View.GONE);        }    }    @Override    public void onFailure(Throwable e) {    }    private void initPopWindow(View v1) {        Logger.i(TAG,123+"");        View inflate = View.inflate(getActivity(), R.layout.layout_zf, null);        RadioGroup radioGroup=inflate.findViewById(R.id.radio_zx_zffs);        RadioButton radioButton_wx=inflate.findViewById(R.id.radiobutt_wx);        RadioButton radioButton_zfb=inflate.findViewById(R.id.radiobutt_wx);        PopupWindow popupWindow = new PopupWindow(inflate, ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT, true);        popupWindow.setTouchable(true);        popupWindow.setTouchInterceptor(new View.OnTouchListener() {            @Override            public boolean onTouch(View view, MotionEvent motionEvent) {                return false;            }        });        popupWindow.setBackgroundDrawable(new ColorDrawable(0x00000000));        popupWindow.showAsDropDown(v1,50,-550);        radioGroup.setOnCheckedChangeListener(new RadioGroup.OnCheckedChangeListener() {            @Override            public void onCheckedChanged(RadioGroup radioGroup, int i) {                switch (i){                    case R.id.radiobutt_wx:                        buttDfkPrice.setText("微信支付"+String.format("%.2f", price));                        buttDfkPrice.setOnClickListener(new View.OnClickListener() {                            @Override                            public void onClick(View view) {                                Logger.i(TAG,"微信支付");                                mPresenter.getZfPresenter(login.userId,login.sessionId,"1",orderId);                            }                        });                        popupWindow.dismiss();                        break;                    case R.id.radiobutt_zfb:                        buttDfkPrice.setText("支付宝支付"+String.format("%.2f",price));                        buttDfkPrice.setOnClickListener(new View.OnClickListener() {                            @Override                            public void onClick(View view) {                                Logger.i(TAG,"支付宝支付");                            }                        });                        popupWindow.dismiss();                        break;                }            }        });    }}